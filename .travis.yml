language: python
cache: pip

services:
  - docker

sudo: false

env:
  global:
  - DOCKER_REPO=nhsuk/conditions-content-store
  - DOCKER_USERNAME=nhsukautomata

python:
  - 3.5
install:
  - pip install -r requirements/dev.txt
  - pip install coveralls
script:
  - coverage run manage.py test
  - flake8 .
after_success:
  - coveralls
  - docker login -u="$DOCKER_USERNAME" -p="$DOCKER_PASSWORD"
  - ./scripts/ci-deployment/docker_ci.sh
